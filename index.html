<main id="contenido" role="main">
  <div class="container">
    <!-- Intro breve (mantén tu texto anterior si quieres) -->
    <section aria-labelledby="intro">
      <p>Esta práctica presenta tres visualizaciones interactivas creadas con <strong>Plotly</strong> y <strong>Bokeh</strong> a partir del conjunto de datos <em>Lifestyle and Wellbeing Data</em> (Kaggle, 2023). Usa las pestañas o las flechas para navegar.</p>
    </section>

    <!-- NAV STICKY -->
    <nav class="tabs" role="tablist" aria-label="Visualizaciones">
      <button role="tab" id="tab-stacked" aria-controls="panel" aria-selected="true" data-src="stacked_bar.html" data-title="Grupo I — Stacked Bar Graph (Barras Apiladas)">Barras apiladas</button>
      <button role="tab" id="tab-boxplot" aria-controls="panel" aria-selected="false" data-src="boxplot.html" data-title="Grupo II — Box Plot (Diagrama de Caja)">Box plot</button>
      <button role="tab" id="tab-hexbin"  aria-controls="panel" aria-selected="false" data-src="hexbin_bokeh.html" data-title="Grupo III — Hexbin (Agregación hexagonal)">Hexbin</button>
      <div class="spacer"></div>
      <div class="nav-arrows" aria-hidden="false">
        <button id="prev" aria-label="Anterior">⬅️</button>
        <button id="next" aria-label="Siguiente">➡️</button>
      </div>
    </nav>

    <!-- TÍTULO DINÁMICO -->
    <h2 id="chart-title" class="vis-title">Grupo I — Stacked Bar Graph (Barras Apiladas)</h2>

    <!-- LOADER / SKELETON -->
    <div id="skeleton" class="skeleton" aria-hidden="true"></div>

    <!-- VISOR -->
    <iframe id="frame" title="Visualización interactiva" src="stacked_bar.html" loading="lazy"></iframe>

    <!-- Nota accesibilidad -->
    <p class="note">Sugerencia: puedes usar las flechas del teclado (← →) para cambiar de visualización. En móvil, desliza lateralmente.</p>
  </div>
</main>

<style>
  .container{max-width:980px;margin:0 auto;padding:1rem 1.25rem;}
  .tabs{
    position:sticky; top:0; z-index:20; display:flex; gap:.5rem; align-items:center;
    background:#fff; padding:.6rem .6rem; border:1px solid #e5e7eb; border-radius:14px;
    box-shadow:0 4px 16px rgba(0,0,0,.04); margin:.75rem 0 1rem 0;
  }
  .tabs button[role="tab"]{
    appearance:none; border:2px solid transparent; background:#f3f4f6; color:#111827;
    padding:.55rem .9rem; border-radius:12px; font-weight:600; cursor:pointer;
  }
  .tabs button[aria-selected="true"]{ background:#1f2937; color:#fff; }
  .tabs button:focus-visible{ outline:3px solid #2563eb; outline-offset:2px; }
  .spacer{flex:1}
  .nav-arrows button{
    border:none; background:#1f2937; color:#fff; font-weight:700; border-radius:10px;
    padding:.45rem .7rem; cursor:pointer;
  }
  .nav-arrows button:disabled{ background:#9ca3af; cursor:not-allowed; }
  .vis-title{margin:.6rem 0 1rem 0; border-left:4px solid #1f2937; padding-left:.6rem;}
  #frame{
    width:100%; border:1px solid #e5e7eb; border-radius:14px; background:#fff;
    box-shadow:0 6px 24px rgba(0,0,0,.05);
    height:68vh; /* auto-alto inicial */
  }
  .skeleton{
    display:none; width:100%; height:68vh; border-radius:14px; background:linear-gradient(90deg,#f4f4f5 25%,#eaeaea 37%,#f4f4f5 63%);
    background-size:400% 100%; animation:shine 1.2s infinite ease-out;
    border:1px solid #e5e7eb;
  }
  @keyframes shine{0%{background-position:100% 0}100%{background-position:0 0}}
  .note{color:#6b7280; font-size:.95rem; margin:.6rem 0 0}
  @media (prefers-reduced-motion:reduce){ .skeleton{animation:none} }
</style>

<script>
  // Map tab -> hash
  const routes = {
    '#stacked': {tab:'tab-stacked'},
    '#boxplot': {tab:'tab-boxplot'},
    '#hexbin' : {tab:'tab-hexbin'}
  };
  const order = ['#stacked','#boxplot','#hexbin'];

  const tabs  = [...document.querySelectorAll('[role="tab"]')];
  const frame = document.getElementById('frame');
  const title = document.getElementById('chart-title');
  const skeleton = document.getElementById('skeleton');
  const prevBtn = document.getElementById('prev');
  const nextBtn = document.getElementById('next');

  function setActiveByHash(hash, push=true){
    if(!routes[hash]) hash = '#stacked';
    const tabId = routes[hash].tab;
    tabs.forEach(b => b.setAttribute('aria-selected', String(b.id===tabId)));
    const active = document.getElementById(tabId);
    title.textContent = active.dataset.title;
    // loader
    skeleton.style.display = 'block';
    frame.style.visibility = 'hidden';
    frame.src = active.dataset.src;
    // history
    if(push) history.pushState({hash}, '', hash);
    updateArrows(hash);
  }

  function updateArrows(hash){
    const idx = order.indexOf(hash);
    prevBtn.disabled = idx<=0;
    nextBtn.disabled = idx>=order.length-1;
  }

  // Frame loaded -> ocultar loader
  frame.addEventListener('load', () => {
    skeleton.style.display = 'none';
    frame.style.visibility = 'visible';
  });

  // Tabs click
  tabs.forEach(b => b.addEventListener('click', () => {
    const hash = b.id==='tab-stacked' ? '#stacked' : b.id==='tab-boxplot' ? '#boxplot' : '#hexbin';
    setActiveByHash(hash);
  }));

  // Keyboard (← →)
  window.addEventListener('keydown', e=>{
    const hash = location.hash || '#stacked';
    let idx = order.indexOf(hash);
    if(e.key==='ArrowRight' && idx<order.length-1){ setActiveByHash(order[++idx]); }
    if(e.key==='ArrowLeft'  && idx>0){ setActiveByHash(order[--idx]); }
  });

  // Swipe básico para móvil
  let sx=null;
  window.addEventListener('touchstart', e=>{ sx = e.changedTouches[0].screenX; });
  window.addEventListener('touchend',   e=>{
    if(sx===null) return; const dx = e.changedTouches[0].screenX - sx; sx=null;
    const hash = location.hash || '#stacked'; let idx = order.indexOf(hash);
    if(dx<-40 && idx<order.length-1){ setActiveByHash(order[++idx]); }
    if(dx> 40 && idx>0){ setActiveByHash(order[--idx]); }
  });

  // Prev / Next
  prevBtn.addEventListener('click', ()=>{
    const hash = location.hash || '#stacked'; let i = order.indexOf(hash);
    if(i>0) setActiveByHash(order[--i]);
  });
  nextBtn.addEventListener('click', ()=>{
    const hash = location.hash || '#stacked'; let i = order.indexOf(hash);
    if(i<order.length-1) setActiveByHash(order[++i]);
  });

  // Ajuste dinámico de altura del iframe
  function resizeFrame(){ frame.style.height = Math.max(420, Math.round(window.innerHeight*0.68)) + 'px'; }
  window.addEventListener('resize', resizeFrame);
  resizeFrame();

  // Enrutado por hash + soporte de botón Atrás/Adelante
  window.addEventListener('popstate', ()=> setActiveByHash(location.hash || '#stacked', /*push*/false));
  // Estado inicial
  setActiveByHash(location.hash || '#stacked', /*push*/false);
</script>
